# ===================================
# 1. メモリと安定性 (チューニング)
# ===================================

# 🚨 ホストOSで vm.overcommit_memory=1 が設定されていることを前提とします。
# vm.overcommit_memory 1

# 最大メモリ設定 (重要: Docker環境では必須)
maxmemory 2048mb 

# 最大メモリに達した際のデータ削除ポリシー
# allkeys-lru: 全てのキーからLRU (最も古く使われた) アルゴリズムで古いものを削除 (推奨)
maxmemory-policy allkeys-lru


# ===================================
# 2. ネットワーク設定 (Docker対応)
# ===================================

# 接続を受け付けるIPアドレス
# Docker Composeのコンテナ間通信のために 0.0.0.0 を指定
bind 0.0.0.0
port 6379

# ===================================
# 3. AOFによる永続化 (データ耐久性)
# ===================================

# AOF (Append Only File) を有効化 (データ損失のリスクを最小化)
appendonly yes
# fsync (ディスクへの強制書き込み) の頻度設定
# everysec: 1秒に1回 (パフォーマンスと耐久性のバランスが良い)
appendfsync everysec

# RDBスナップショットはAOFが有効な場合は補助的に機能しますが、
# ここではAOFを優先し、デフォルトのsave設定を維持します。
# save 900 1 (15分に1回)

# ===================================
# 4. その他
# ===================================

# データベースの数
databases 16
